<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ì¹˜ì´ì¹´ì™€ Â· ëŒ„ìŠ¤ íŒŒí‹°</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100svh;
        display: grid;
        place-items: center;
        background: radial-gradient(
            1100px 540px at 12% 10%,
            #22c55e22,
            transparent
          ),
          radial-gradient(900px 520px at 88% 18%, #3b82f622, transparent),
          linear-gradient(135deg, #3b82f6, #ec4899);
        font-family: ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto,
          'Noto Sans KR', sans-serif;
        color: #fff;
      }
      .card {
        width: min(860px, 94vw);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 22px;
        padding: 26px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
        text-align: center;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(8px);
      }
      h1 {
        margin: 0 0 6px;
        font-weight: 900;
      }
      p {
        margin: 0 0 14px;
        opacity: 0.95;
      }

      /* ì‚´ì§ í”ë“¤ë¦¬ëŠ” ì½˜í˜í‹°(ë°°ê²½) */
      .confetti {
        position: absolute;
        inset: 0;
        pointer-events: none;
        opacity: 0.8;
        background-image: radial-gradient(
            circle at 10% 10%,
            #fff 0 2px,
            transparent 3px
          ),
          radial-gradient(circle at 50% 20%, #facc15 0 2px, transparent 3px),
          radial-gradient(circle at 80% 10%, #22d3ee 0 2px, transparent 3px),
          radial-gradient(circle at 30% 25%, #a3e635 0 2px, transparent 3px),
          radial-gradient(circle at 60% 30%, #f472b6 0 2px, transparent 3px);
        animation: confetti 2s linear infinite alternate;
        z-index: 0;
      }
      @keyframes confetti {
        from {
          transform: translateY(-5%);
        }
        to {
          transform: translateY(5%);
        }
      }

      /* ìŠ¤í…Œì´ì§€ */
      .stage-wrap {
        margin-top: 6px;
        perspective: 1200px;
      }
      .stage {
        position: relative;
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.24);
        box-shadow: 0 0 28px rgba(255, 255, 255, 0.15) inset;
        background: rgba(0, 0, 0, 0.12);
        transform-style: preserve-3d;
        transition: transform 0.12s ease;
      }
      /* ì• ë‹ˆë©”ì´í‹°ë“œ ë³´ë” */
      .stage::before {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 20px;
        background: conic-gradient(
          from 0deg,
          #22d3ee,
          #a78bfa,
          #f472b6,
          #facc15,
          #22d3ee
        );
        filter: blur(10px);
        opacity: 0.35;
        z-index: 0;
        animation: spin 8s linear infinite;
        mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        padding: 2px;
      }
      @keyframes spin {
        to {
          transform: rotate(1turn);
        }
      }

      /* ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ */
      .spot {
        position: absolute;
        inset: -20% -10%;
        z-index: 0;
        pointer-events: none;
        background: radial-gradient(
          60% 60% at var(--mx, 50%) var(--my, 40%),
          rgba(255, 255, 255, 0.16),
          transparent 60%
        );
        mix-blend-mode: screen;
        transition: background-position 0.1s ease;
      }

      /* ë©”ì¸ ì´ë¯¸ì§€ */
      .img {
        position: relative;
        z-index: 1;
        display: block;
        width: 100%;
        height: auto;
        transform-origin: 50% 90%;
        animation: dance 1.2s ease-in-out infinite;
        image-rendering: -webkit-optimize-contrast;
      }
      @keyframes dance {
        0% {
          transform: translateY(0) rotate(0deg) scale(1);
        }
        25% {
          transform: translateY(-6px) rotate(-2deg) scale(1.02);
        }
        50% {
          transform: translateY(0) rotate(0deg) scale(1);
        }
        75% {
          transform: translateY(-6px) rotate(2deg) scale(1.02);
        }
        100% {
          transform: translateY(0) rotate(0deg) scale(1);
        }
      }

      /* ìë§‰ */
      .subtitle {
        position: absolute;
        left: 12px;
        bottom: 12px;
        z-index: 3;
        background: rgba(0, 0, 0, 0.45);
        color: #fff;
        font-weight: 700;
        font-size: 0.95rem;
        letter-spacing: -0.01em;
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 999px;
        padding: 8px 12px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
        user-select: none;
        backdrop-filter: blur(4px);
      }

      /* ê½ƒì */
      .petals {
        pointer-events: none;
        position: absolute;
        inset: 0;
        overflow: hidden;
        z-index: 2;
      }
      .petal {
        position: absolute;
        top: -10vh;
        width: 14px;
        height: 12px;
        background: radial-gradient(
          ellipse at 60% 40%,
          #f9a8d4 0%,
          #f472b6 60%,
          #ec4899 100%
        );
        border-radius: 60% 60% 60% 60% / 70% 70% 40% 40%;
        opacity: 0.95;
        filter: drop-shadow(0 4px 6px rgba(236, 72, 153, 0.35));
        transform: rotate(var(--rot));
        animation: fall linear var(--fall-dur) var(--fall-delay) both,
          sway ease-in-out var(--sway-dur) var(--sway-delay) infinite alternate;
      }
      .petal::after {
        content: '';
        position: absolute;
        inset: 2px 4px auto auto;
        width: 6px;
        height: 4px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.55);
        transform: rotate(-20deg);
      }
      @keyframes fall {
        to {
          transform: translateY(110vh) rotate(calc(var(--rot) + 160deg));
        }
      }
      @keyframes sway {
        from {
          translate: 0 0;
        }
        to {
          translate: var(--sway-x, 32px) 8px;
        }
      }

      /* ëª¨ì…˜ ìµœì†Œí™” */
      @media (prefers-reduced-motion: reduce) {
        .img,
        .confetti,
        .stage::before,
        .petal {
          animation: none !important;
        }
      }

      .controls {
        margin-top: 14px;
        display: grid;
        gap: 10px;
        justify-content: center;
      }
      .rows {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }
      button,
      .chip {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.35);
        color: #000;
        background: #22d3ee;
        border-radius: 999px;
        padding: 10px 16px;
        cursor: pointer;
        transition: transform 0.05s ease, background 0.2s ease,
          border-color 0.2s ease;
        font-weight: 700;
      }
      button:hover,
      .chip:hover {
        background: #67e8f9;
      }
      button:active,
      .chip:active {
        transform: translateY(1px);
      }
      #status {
        font-size: 0.95rem;
        opacity: 0.95;
        color: #fff;
      }
      input[type='range'] {
        width: min(420px, 70vw);
        accent-color: #22d3ee;
      }
      .chip {
        background: rgba(34, 211, 238, 0.18);
        color: #fff;
        border-color: rgba(255, 255, 255, 0.28);
      }

      .footer {
        opacity: 0.9;
        font-size: 0.9rem;
        margin-top: 6px;
      }
    </style>
  </head>
  <body>
    <main class="card" id="root">
      <div class="confetti" aria-hidden="true"></div>
      <h1>ã¡ã„ã‹ã‚ã€ã‚ãã‚ããªä¸€æ—¥! ğŸ‰</h1>

      <div class="stage-wrap">
        <div class="stage" id="stage" aria-label="ì¶¤ì¶”ëŠ” ì¹˜ì´ì¹´ì™€ ì´ë¯¸ì§€">
          <div class="spot" aria-hidden="true"></div>

          <!-- ê½ƒì -->
          <div class="petals" aria-hidden="true"></div>

          <!-- ë©”ì¸ ì´ë¯¸ì§€ -->
          <img
            class="img"
            src="./assets/dance.gif"
            alt="ã¡ã„ã‹ã‚ã€ã‚ãã‚ããªä¸€æ—¥ï¼"
            loading="eager"
            onerror="this.onerror=null; this.src='assets/dance.jpg'; this.onerror=function(){ this.src='assets/dance.png'; };"
          />

          <!-- ìë§‰ (ìˆœí™˜) -->
          <span class="subtitle" id="subtitle" aria-live="polite"
            >ä»Šæ—¥ã¯ã˜ã—ã‚“ã‚’ã‚‚ã£ã¦ï¼ âœ¨</span
          >
        </div>
      </div>

      <div class="controls" role="group" aria-label="ì˜¤ë””ì˜¤ ë° íš¨ê³¼ ì œì–´">
        <div class="rows">
          <button id="play" aria-label="ë°°ê²½ìŒì•… ì¬ìƒ">â–¶ ìŒì•… ì¼œê¸°</button>
          <button id="pause" aria-label="ë°°ê²½ìŒì•… ì¼ì‹œì •ì§€">â¸ ì¼ì‹œì •ì§€</button>
          <button id="togglePetals" class="chip" aria-pressed="true">
            ğŸŒ¸ ê½ƒë¹„ ON
          </button>
        </div>

        <input
          id="seek"
          type="range"
          min="0"
          max="1000"
          value="0"
          aria-label="ì¬ìƒ ìœ„ì¹˜"
        />
        <div class="rows">
          <label class="chip" style="padding: 8px 12px">
            ğŸ”Š ë³¼ë¥¨
            <input
              id="vol"
              type="range"
              min="0"
              max="1"
              step="0.01"
              value="0.8"
              style="vertical-align: middle; width: 160px; margin-left: 8px"
            />
          </label>
          <span id="status">ì •ì§€ë¨</span>
        </div>
        <div class="footer">
          ë‹¨ì¶•í‚¤: Space(ì¬ìƒ/ì¼ì‹œì •ì§€), â†/â†’(5ì´ˆ ì´ë™), â†‘/â†“(ë³¼ë¥¨)
        </div>
      </div>

      <audio id="bgm" preload="auto" loop>
        <source src="./assets/dance.mp3" type="audio/mpeg" />
        <source src="assets/dance.m4a" type="audio/mp4" />
        <source src="assets/dance.ogg" type="audio/ogg" />
      </audio>
    </main>

    <script>
      // ===== ì—˜ë¦¬ë¨¼íŠ¸ =====
      const audio = document.getElementById('bgm')
      const statusEl = document.getElementById('status')
      const seek = document.getElementById('seek')
      const vol = document.getElementById('vol')
      const playBtn = document.getElementById('play')
      const pauseBtn = document.getElementById('pause')
      const stage = document.getElementById('stage')
      const subtitle = document.getElementById('subtitle')
      const spot = document.querySelector('.spot')
      const petalsLayer = document.querySelector('.petals')
      const togglePetalsBtn = document.getElementById('togglePetals')

      // ===== ìƒíƒœ ë³µì› =====
      const saved = JSON.parse(localStorage.getItem('dance:state') || '{}')
      audio.volume = saved.volume ?? 0.8
      vol.value = audio.volume
      let captionIndex = saved.captionIndex ?? 0
      let petalsOn = saved.petalsOn ?? true
      togglePetalsBtn.setAttribute('aria-pressed', petalsOn)
      petalsLayer.style.display = petalsOn ? '' : 'none'

      // ===== ì˜¤ë””ì˜¤ ì œì–´ =====
      const updateStatus = (txt) => (statusEl.textContent = txt)

      playBtn.addEventListener('click', async () => {
        try {
          await audio.play()
          updateStatus('ì¬ìƒ ì¤‘')
        } catch {
          updateStatus('ì¬ìƒ ì‹¤íŒ¨(ì²« ìƒí˜¸ì‘ìš© í•„ìš”/íŒŒì¼ ì—†ìŒ)')
        }
      })
      pauseBtn.addEventListener('click', () => {
        audio.pause()
        updateStatus('ì¼ì‹œì •ì§€')
      })

      // ì²« ì‚¬ìš©ì ì œìŠ¤ì²˜ ì‹œ ìë™ ì–¸ë½ ì‹œë„(ëª¨ë°”ì¼ ë“± ëŒ€ë¹„)
      document.addEventListener(
        'pointerdown',
        async () => {
          if (audio.paused) {
            try {
              await audio.play()
              updateStatus('ì¬ìƒ ì¤‘')
            } catch {}
          }
        },
        { once: true }
      )

      vol.addEventListener('input', () => {
        audio.volume = Number(vol.value)
        persist()
      })

      audio.addEventListener('timeupdate', () => {
        if (audio.duration)
          seek.value = Math.floor((audio.currentTime / audio.duration) * 1000)
      })
      seek.addEventListener('input', () => {
        if (audio.duration)
          audio.currentTime = (seek.value / 1000) * audio.duration
      })

      // ===== ë‹¨ì¶•í‚¤ =====
      document.addEventListener('keydown', (e) => {
        if (
          ['INPUT', 'TEXTAREA', 'SELECT'].includes(
            document.activeElement.tagName
          )
        )
          return
        if (e.code === 'Space') {
          e.preventDefault()
          audio.paused ? audio.play() : audio.pause()
        }
        if (e.code === 'ArrowLeft')
          audio.currentTime = Math.max(0, audio.currentTime - 5)
        if (e.code === 'ArrowRight')
          audio.currentTime = Math.min(
            audio.duration || 0,
            audio.currentTime + 5
          )
        if (e.code === 'ArrowUp') {
          audio.volume = Math.min(1, audio.volume + 0.05)
          vol.value = audio.volume
          persist()
        }
        if (e.code === 'ArrowDown') {
          audio.volume = Math.max(0, audio.volume - 0.05)
          vol.value = audio.volume
          persist()
        }
      })

      // ===== ë§ˆìš°ìŠ¤ ìŠ¤í¬íŠ¸ë¼ì´íŠ¸ & í‹¸íŠ¸ =====
      stage.addEventListener('pointermove', (e) => {
        const rect = stage.getBoundingClientRect()
        const x = ((e.clientX - rect.left) / rect.width) * 100
        const y = ((e.clientY - rect.top) / rect.height) * 100
        spot.style.setProperty('--mx', x + '%')
        spot.style.setProperty('--my', y + '%')

        const rx = (0.5 - y / 100) * 6 // Xì¶• ê¸°ìš¸ê¸°
        const ry = (x / 100 - 0.5) * 6 // Yì¶• ê¸°ìš¸ê¸°
        stage.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`
      })
      stage.addEventListener('pointerleave', () => {
        stage.style.transform = 'rotateX(0deg) rotateY(0deg)'
      })

      // ===== ìë§‰ ë¡œí…Œì´ì…˜ =====
      const lines = [
        'ä»Šæ—¥ã¯ã˜ã—ã‚“ã‚’ã‚‚ã£ã¦ï¼ âœ¨',
        'ã¡ã„ã‹ã‚ã€ã‚ãã‚ãï¼ ğŸ’«',
        'ì˜¤ëŠ˜ë„ ì„¤ë ˆëŠ” í•˜ë£¨ê°€ ë  ê±°ì•¼! ğŸŒ¸',
        'è‡ªåˆ†ã‚’ä¿¡ã˜ã¦ã€ãƒ•ã‚¡ã‚¤ãƒˆï¼ ğŸ’ª',
        'ì‘ì€ í•œ ê±¸ìŒ, í° ê¸°ì¨ âœ¨',
      ]
      function rotateSubtitle() {
        captionIndex = (captionIndex + 1) % lines.length
        subtitle.textContent = lines[captionIndex]
        persist()
      }
      setInterval(rotateSubtitle, 3200)

      // ===== ê½ƒì í† ê¸€ & ìƒì„± =====
      togglePetalsBtn.addEventListener('click', () => {
        petalsOn = !petalsOn
        togglePetalsBtn.setAttribute('aria-pressed', petalsOn)
        petalsLayer.style.display = petalsOn ? '' : 'none'
        persist()
      })

      const rnd = (min, max) => Math.random() * (max - min) + min
      const PETAL_COUNT = 20

      function spawnPetals() {
        petalsLayer.innerHTML = ''
        for (let i = 0; i < PETAL_COUNT; i++) {
          const p = document.createElement('span')
          p.className = 'petal'
          p.style.left = rnd(0, 100) + 'vw'
          const speed = rnd(7, 13)
          p.style.setProperty('--fall-dur', speed + 's')
          p.style.setProperty('--fall-delay', rnd(-speed, 0) + 's')
          p.style.setProperty('--sway-dur', rnd(2.4, 5.0) + 's')
          p.style.setProperty('--sway-delay', rnd(0, 2) + 's')
          p.style.setProperty('--sway-x', rnd(18, 44) + 'px')
          p.style.setProperty('--rot', rnd(-40, 40) + 'deg')
          petalsLayer.appendChild(p)
        }
      }
      spawnPetals()

      // ===== ìƒíƒœ ì €ì¥ =====
      function persist() {
        localStorage.setItem(
          'dance:state',
          JSON.stringify({
            volume: audio.volume,
            captionIndex,
            petalsOn,
          })
        )
      }

      audio.addEventListener('play', () => updateStatus('ì¬ìƒ ì¤‘'))
      audio.addEventListener('pause', () => updateStatus('ì¼ì‹œì •ì§€'))
      audio.addEventListener('ended', () => updateStatus('ì •ì§€ë¨'))
    </script>
  </body>
</html>
